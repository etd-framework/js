define(["jquery","etdsolutions/app","etdsolutions/text"],function(t,a,n){function i(a,i,e,s,o,r){var d={};t.each(s.props,function(t,a){d[a]=i.data(t)}),d[s.valueName]=o,d[s.token]="1",e.hasClass("fa-spin")||(e.removeClass("fa-warning "+s.icons).addClass("fa-spin fa-refresh"),a.task(s.uri,d,function(t){s.successCallback&&s.successCallback(t,i,o),i.data("current",o);var a=r(o,s.states||{});i.tooltip("destroy"),i.attr("title",n._(a.txt)),i.tooltip({container:"body",html:!0}),e.removeClass("fa-spin fa-refresh").addClass(a.icon)},function(){e.removeClass("fa-spin fa-refresh").addClass("fa-warning")}))}function e(a,n,e,s,o){t(e).on("click",function(e){e.preventDefault();var r,d=t(this),f=d.find(".fa");if("toggle"==n)r=1-d.data("current"),i(a,d,f,s,r,o);else if("choice"==n&&!d.data("init")){var c="";t.each(s.states,function(t){"default"!=t&&(c+='<label class="radio-inline"><input type="radio" name="'+s.valueName+'" value="'+t+'"> '+this.txt+"</label>")}),d.popover({html:!0,content:c,placement:"bottom",template:'<div class="popover popover-choice" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("shown.bs.popover",function(){d.data("bs.popover").$tip.find("input").on("change",function(){d.popover("hide"),r=t(this).val(),i(a,d,f,s,r,o)})}),d.data("init",!0),d.popover("show")}})}return{createChoiceBtn:function(t,a){return e(this,"choice",t,a,function(t,a){var n={txt:a["default"].txt,icon:a["default"].icon};return a[t]&&(n.txt=a[t].txt,n.icon=a[t].icon),n}),this},createToggleBtn:function(t,a){if(a.icons||(a.icons="fa-check fa-times"),a.states)var n=function(t,a){var n={txt:a["default"].txt,icon:a["default"].icon};return a[t]&&(n.txt=a[t].txt,n.icon=a[t].icon),n};else var n=function(t,a){var n={txt:"",icon:""};return 1==t?(n.txt="APP_GLOBAL_YES",n.icon="fa-check"):(n.txt="APP_GLOBAL_NO",n.icon="fa-times"),n};return e(this,"toggle",t,a,n),this},task:function(n,i,e,s){return t.ajax(n,{dataType:"json",type:"POST",data:i}).done(function(t){t.error?(a.raiseError(t.message),s&&s(t)):e&&e(t)}).fail(function(t){t.responseJSON&&t.responseJSON.error?(a.raiseError(t.responseJSON.message),s&&s(t.responseJSON)):s&&s()})}}});
